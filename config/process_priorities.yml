# Process Priority Configuration
# Defines how process priorities should be assigned based on workload types
# Used by ProcessPriorityManager for EEVDF scheduler optimization

# Priority Classes (nice values):
# CRITICAL: -20 (Highest priority, real-time-like)
# HIGH: -10 (High priority, interactive)
# NORMAL: 0 (Default priority)
# LOW: 10 (Low priority, batch processing)
# BACKGROUND: 19 (Lowest priority, background tasks)

# Process Priority Mappings
# References workload types defined in workload_patterns.yml
# No process patterns here - they come from workload_patterns.yml

priority_mappings:
  database:
    description: "Database servers and data stores (HIGHEST PRIORITY)"
    priority_class: CRITICAL  # -20 

  
  web_server:
    description: "Web servers and HTTP services"
    priority_class: HIGH  # -10

  
  hpc_compute:
    description: "High-performance computing workloads"
    priority_class: NORMAL  # 0
   
  
  compilation:
    description: "Software compilation and build processes"
    priority_class: LOW  # 10
  
  io_intensive:
    description: "I/O heavy operations"
    priority_class: LOW  # 10
  
  general:
    description: "General purpose workload"
    priority_class: NORMAL  # 0
  
  # Special system processes (not in workload_patterns)
  system_critical:
    description: "Critical system processes (supporting services)"
    priority_class: HIGH  # -10
    patterns:
      - "systemd"
      - "kernel"
      - "init"
      - "ssh"
      - "sshd"
      - "dbus"
  
  background_tasks:
    description: "Background maintenance and batch tasks (lowest priority)"
    priority_class: BACKGROUND  # 19
    patterns:
      - "cron"
      - "rsync"
      - "backup"
      - "updatedb"
      - "logrotate"
      - "anacron"

# Workload-specific priority boosts
# When a specific workload is detected as dominant, these boosts apply
workload_focus_boost:
  enabled: true
  boost_amount: 5  # Reduce nice value by this amount (increase priority)
  max_priority: -20  # Never exceed this priority level

# Process filtering rules
filter_rules:
  # Process IDs to never modify
  exclude_pids:
    - 0  # swapper
    - 1  # init/systemd
    - 2  # kthreadd
  
  # Process name prefixes to exclude (kernel threads)
  exclude_prefixes:
    - "["
    - "kthreadd"
    - "ksoftirqd"
    - "kworker"
  
  # Minimum CPU usage to consider for priority adjustment (percentage)
  min_cpu_threshold: 0.75
  
  # Minimum memory usage to consider (percentage)
  min_memory_threshold: 0.75
  
  # Short-lived process filtering
  # Prevents wasting resources on processes that start and stop quickly
  min_process_age: 2.0  # Minimum process uptime in seconds before considering for adjustment
  
  # Process stability tracking
  # Only adjust processes that appear consistently across multiple scans
  stability_tracking:
    enabled: false
    required_observations: 2  # Number of scans a process must appear in before adjustment
    observation_window: 30  # Time window in seconds to track process stability

  

# Safety settings
safety:
  # Require confirmation before modifying critical system processes
  confirm_critical: true
  
  # Maximum number of processes to adjust in one operation
  max_processes_per_run: 100
  
  # Allow restoring original priorities on cleanup
  enable_restore: true
  
  # Dry run mode (log changes without applying)
  dry_run: false
